<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/tab-home"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ list?.name }} </ion-title>
    <ion-icon size="large" slot="end" name="create-outline"></ion-icon>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-item lines="none">
        <ion-label>
          <h1>{{ list?.name }}</h1>
          <p>{{ list?.description }}</p>
        </ion-label>
      </ion-item>
    </ion-toolbar>
  </ion-header>

  <ion-item lines="none">
    <ion-searchbar
      placeholder="Search this page"
      show-clear-button="focus"
    ></ion-searchbar>
  </ion-item>
  <ion-item lines="none">
    <ion-label>
      <h2>{{list?.total_movie}} Titles</h2>
      <p>Sorted by {{sort_by}}</p>
    </ion-label>
    <ion-icon name="add" slot="end"></ion-icon>
    <ion-icon
      slot="end"
      name="filter"
      (click)="setOpenFilters(true)"
    ></ion-icon>
  </ion-item>

  <ion-list *ngFor="let item of listitems">
    <ion-item-sliding>
      <ion-item-options side="end">
        <ion-item-option color="danger">
          <ion-icon slot="top" name="trash"></ion-icon>
          Delete
        </ion-item-option>
      </ion-item-options>
      <ion-item button [routerLink]="['./items',item.movie.id]">
        <img slot="start" src="{{item.movie.poster}}" />
        <ion-label class="ion-text-wrap">
          <h2>{{ item.movie.title }}</h2>
          <ion-item lines="none" class="aa">
            <ion-icon slot="start" name="star" class="icon_aa"> </ion-icon>
            <h3 class="h3-aa">{{ item.movie.imdbrating }}</h3>
            <h3 class="h3-aa">{{ item.movie.year }}</h3>
            <h3 class="h3-aa">{{ item.movie.runtime }}</h3>
          </ion-item>
          <p>{{ item.movie.director }}</p>
        </ion-label>
      </ion-item>
    </ion-item-sliding>
  </ion-list>

  <ion-infinite-scroll (ionInfinite)="loadMore($event)">
    <ion-infinite-scroll-content
      loadingSpinner="bubbles"
      loadingText="Loading more data..."
    ></ion-infinite-scroll-content>
  </ion-infinite-scroll>
</ion-content>

<ion-modal [isOpen]="isFiltersModalOpen">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-buttons slot="start">
          <ion-button (click)="setOpenFilters(false)">Cancel</ion-button>
        </ion-buttons>
        <ion-buttons slot="start">
          <ion-button (click)="resetFilters()">Clear</ion-button>
        </ion-buttons>
        <ion-buttons slot="end">
          <ion-button
            type="submit"
            (click)="refine()"
            (click)="setOpenFilters(false)"
            >Refine</ion-button
          >
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content>
      <form (ngSubmit)="refine()" [formGroup]="credentials">
      <ion-accordion-group>
        <ion-accordion>
          <ion-item slot="header">
            <h4>Sort By</h4>
            <p slot="end">{{sort_by}}</p>
          </ion-item>
          <div slot="content">
              <ion-radio-group
                value="movie__added_at"
                formControlName="sortBy"
                (ionChange)="handleChange($event)"
              >
                <ion-item>
                  <ion-item>
                    <ion-label position>Date Added </ion-label>
                    <ion-radio slot="start" value="movie__added_at"></ion-radio>
                  </ion-item>
                  <ion-icon
                    slot="end"
                    name="{{dateAddedIcon}}"
                    (click)="changeSortdir('movie__added_at')"
                  ></ion-icon>
                </ion-item>

                <ion-item>
                  <ion-item>
                    <ion-label>Title</ion-label>
                    <ion-radio slot="start" value="movie__title"></ion-radio>
                  </ion-item>
                  <ion-icon
                    slot="end"
                    name="{{titleIcon}}"
                    (click)="changeSortdir('movie__title')"
                  ></ion-icon>
                </ion-item>

                <ion-item>
                  <ion-item>
                    <ion-label position>Year</ion-label>
                    <ion-radio slot="start" value="movie__year"></ion-radio>
                  </ion-item>
                  <ion-icon
                    slot="end"
                    name="{{yearIcon}}"
                    (click)="changeSortdir('movie__year')"
                  ></ion-icon>
                </ion-item>

                <ion-item>
                  <ion-item>
                    <ion-label position>IMDb rating</ion-label>
                    <ion-radio
                      slot="start"
                      value="movie__imdbrating"
                    ></ion-radio>
                  </ion-item>
                  <ion-icon
                    slot="end"
                    name="{{imdbratingIcon}}"
                    (click)="changeSortdir('movie__imdbrating')"
                  ></ion-icon>
                </ion-item>

                <ion-item>
                  <ion-item>
                    <ion-label position>Metascore</ion-label>
                    <ion-radio
                      slot="start"
                      value="movie__metascore"
                    ></ion-radio>
                  </ion-item>
                  <ion-icon
                    slot="end"
                    name="{{metascoreIcon}}"
                    (click)="changeSortdir('movie__metascore')"
                  ></ion-icon>
                </ion-item>

                <ion-item>
                  <ion-item>
                    <ion-label position>Runtime</ion-label>
                    <ion-radio slot="start" value="movie__runtime"></ion-radio>
                  </ion-item>
                  <ion-icon
                    slot="end"
                    name="{{runtimeIcon}}"
                    (click)="changeSortdir('movie__runtime')"
                  ></ion-icon>
                </ion-item>
              </ion-radio-group>
            </div>
          </ion-accordion>
          <ion-accordion>
            <ion-item slot="header">
              <h4>Year</h4>
              <p slot="end">{{years[0]}}-{{years.slice(-1)}}</p>
            </ion-item>
            <div slot="content">
              
              <ion-range
                [dualKnobs]="true"
                [pin]="true"
                max={{years.slice(-1)}}
                min={{years[0]}}
                [value]="{ lower: 1895, upper: 2023 }"
                (ionChange)="onIonChange($event)"
                ></ion-range>
                <ion-grid>
                  <ion-row>
                    <ion-col>
                      <ion-input
                      type="number"
                      placeholder="{{lowerYears}}"
                      value="{{lowerYears}}"
                      formControlName="loweryears"
                      ></ion-input>
                    </ion-col>
                    <ion-col> </ion-col>
                    <ion-col> </ion-col>
                    <ion-col>
                      <ion-input
                      type="number"
                      placeholder="{{upperYears}}"
                      value="{{upperYears}}"
                      formControlName="upperyears"
                    ></ion-input>
                  </ion-col>
                </ion-row>
              </ion-grid>
              
            </div>
          </ion-accordion>
        </ion-accordion-group>
      </form>
      </ion-content>
    </ng-template>
  </ion-modal>
